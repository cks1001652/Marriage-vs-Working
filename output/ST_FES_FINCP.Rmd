---
title: "Draft Analysis for Married Family & Family Income"
author: "Yicheng Wang, Arnold Lau"
date: "January 31, 2016"
output:
  html_document:
    fig_width: 8
    number_sections: yes
    theme: united
    highlight: tango
    toc: yes
---

# Preparation
````{r, message=FALSE}
library("dplyr")
library("data.table")
library("ggplot2")
library("choroplethr")
````

```{r}
source("lib/readIn.R") # import readIn functions

# hus <- readIn(T,c("ST","FES","FINCP"),"/Users/cheeseloveicecream/Documents/columbia/W4249/ss13husa.csv","/Users/cheeseloveicecream/Documents/columbia/W4249/ss13husb.csv")
```

There are a total of 1,476,313 households in the dataset. In this analysis we focus on a subset of the households via the variable __FES__ (Family Type and Employment Status), looking only at married-couple families.  
```{r}
table(hus$FES, useNA = "ifany")
sum(table(hus$FES)[1:4])
```

There are 666,947 missing values in __FES__, and our subset will have 617,090 households.  

```{r}
hus <- tbl_df(hus)
hus <- hus %>% filter(FES %in% c(1:4)) %>% group_by(FES)
````

# Visuliazation
````{r, message=F}
fescode <- "FES,MarriedFamilyEmployType
1,Both in Labor Force
2,Husband in Labor Force
3,Wife in Labor Force
4,Neither in Labor Force"
fescodes <- fread(fescode)

fesnumbers <- summarise(ds,count=n())
fesnumbers <- left_join(fesnumbers,fescodes,by.x=c("FES"))
Types <- factor(fesnumbers$MarriedFamilyEmployType,levels=unique(fesnumbers$MarriedFamilyEmployType))
````
## Exploraring the basic statistics
````{r}
ggplot(fesnumbers, aes(x= Types , y=fesnumbers$count, fill= Types)) +                        
     geom_bar(stat="identity") + scale_fill_hue(l=50) +
     ylab("Num of People") + 
     xlab("Employment Status") + ggtitle("Comparing Enployment status of Married Family in the US") +
     theme(axis.text.x = element_text(angle = 10, hjust = 0.5),
     panel.background = element_rect(fill = 'white' ))
````
````{r}
summary(ds$FINCP)
````
The median family income is 77000 dollars. We use this as bench line. We want to see the percentage under each type of family who has family income more than 77000 which is approxiamatly middle class.
````{r,message=F}
medianper <- ds	%>%
			filter(FINCP>=77000)		%>%
			group_by(FES)	%>%
			summarise(count	=	n())		%>%
			mutate(Percent	=	count/fesnumbers$count*100)
````
````{r,message=TRUE}
ggplot(medianper, aes(x= Types , y=medianper$Percent, fill= Types)) +                        
       geom_bar(stat="identity") + scale_fill_hue(l=80) +
       ylab("Percent %") + 
       xlab("Employment Status") + ggtitle("Percentages of different Employment Status")+
       theme(axis.text.x = element_text(angle = 10, hjust = 0.5),
       panel.background = element_rect(fill = 'white' ))
````
We can see an interesting result comparing to the previous one that the married family with only wife in the labor force has absolute less numbers of people than the family who has only husband in the labor force, while showing almost the same percentage with more than 77000 family income. This could be investigated later.
````{r,echo=FALSE}
stateCodeCSV = "ST,region
001,alabama
002,alaska
004,arizona
005,arkansas
006,california
008,colorado
009,connecticut
010,delaware
011,district of columbia
012,florida
013,georgia
015,hawaii
016,idaho
017,illinois
018,indiana
019,iowa
020,kansas
021,kentucky
022,louisiana
023,maine
024,maryland
025,massachusetts
026,michigan
027,minnesota
028,mississippi
029,missouri
030,montana
031,nebraska
032,nevada
033,new hampshire
034,new jersey
035,new mexico
036,new york
037,north carolina
038,north dakota
039,ohio
040,oklahoma
041,oregon
042,pennsylvania
044,rhode island
045,south carolina
046,south dakota
047,tennessee
048,texas
049,utah
050,vermont
051,virginia
053,washington
054,west virginia
055,wisconsin
056,wyoming"
stateCodes <- fread(stateCodeCSV)
````


##Mapping Tool
This map shows percentage of family which neither of the member is in the labor force while having more than 121200 dollars (3rd quantile) family income. 
````{r}

stateTotalBoth <- ds	%>%
				  filter(FES==4)		%>%
				  group_by(ST)	%>%
				  summarise(count=n())
				  

medianBoth <- ds	%>%
				filter(FES==4,FINCP>= 121200)	%>%
				group_by(ST)		%>%
				summarise(count=n())
								  
medianBoth <- right_join(medianBoth,stateCodes,by.x=c("ST"))
medianBoth[is.na(medianBoth)] <- 0
medianBoth <- mutate(medianBoth,value=medianBoth$count/stateTotalBoth$count*100)

state_choropleth(medianBoth,title="Percentage of Neither People in labor earning more than 121200",num_colors=3	)
````




